let products = {
  data: [
    {
      productName: "Pinball-kub",
      creator: "Thanut and Chanon",
      category: "Motion",
      price: "30",
      image: "../assets/images/products/motion/Pinball-Kub.png",
      link : "index.html",
    },
    {
      productName: "Pinnball-MooDeng",
      creator: "Palise and Phurichaya",
      category: "Motion",
      price: "30",
      image: "../assets/images/products/motion/MooDeng.png",
      link : "haha.html",
    },
    {
      productName: "Pinball-SquidGame",
      creator: "Natapat and Phruek",
      category: "Motion",
      price: "99",
      image: "../assets/images/products/motion/Squid-Game.png",
      link : "index.html",
    },
    {
      productName: "Commercial-Zesto",
      creator: "Palise and Phurichaya",
      category: "Motion",
      price: "29",
      image: "../assets/images/products/motion/Zesto.png",
      link : "index.html",
    },
    {
      productName: "Commercial-TheBoys",
      creator: "Thanut Chanon Natapat and Phruek",
      category: "Motion",
      price: "129",
      image: "../assets/images/products/motion/The-Boys.png",
      link : "index.html",
    },
    {
      productName: "Lyrics-Blindinglights",
      creator: "Thanut Chanon Natapat and Phruek",
      category: "Motion",
      price: "89",
      image: "../assets/images/products/motion/Lyrics-Video.png",
      link : "index.html",
    },
    {
      productName: "Lyrics-Luther",
      creator: "Palise and Phurichaya",
      category: "Motion",
      price: "189",
      image: "../assets/images/products/motion/Love.png",
      link : "index.html",
    },
    {
      productName: "Factory-HarryPoter",
      creator: "Thanut Chanon Natapat and Phruek",
      category: "Motion",
      price: "49",
      image: "../assets/images/products/motion/Factory-Tour.png",
      link : "index.html",
    },
    {
      productName: "Factory-Teletubbies",
      creator: "Palise and Phurichaya",
      category: "Motion",
      price: "49",
      image: "../assets/images/products/motion/Teletubbies.png",
      link : "index.html",
    },
    {
      productName: "Museum",
      creator: "1103production",
      category: "Motion",
      price: "49",
      image: "../assets/images/products/motion/Museum.png",
      link : "index.html",
    },
     {
      productName: "Fossil",
      creator: "1103production",
      category: "Motion",
      price: "49",
      image: "../assets/images/products/motion/Fossil.png",
      link : "index.html",
    },
    {
      productName: "Loop",
      creator: "Natapat",
      category: "Motion",
      price: "49",
      image: "../assets/images/products/motion/Loop.png",
      link : "index.html",
    },
    {
      productName: "Lowlight",
      creator: "All",
      category: "Production",
      price: "49",
      image: "../assets/images/products/production/Lowlight.jpg",
      link : "index.html",
    },
    {
      productName: "Street",
      creator: "Phruek",
      category: "Production",
      price: "49",
      image: "../assets/images/products/production/Street_jump.jpg",
      link : "index.html",
    },
    {
      productName: "Food Dining",
      creator: "Palise Phurichaya Natapat and Thanut",
      category: "Production",
      price: "49",
      image: "../assets/images/products/production/Food-Dining.jpg",
      link : "index.html",
    },
    {
      productName: "Different",
      creator: "Phruek and Chanon",
      category: "Production",
      price: "49",
      image: "../assets/images/products/production/Different.jpg",
      link : "index.html",
    },
    {
      productName: "Stock photo",
      creator: "Phruek",
      category: "Production",
      price: "49",
      image: "../assets/images/products/production/Stock_jump.HEIC",
      link : "index.html",
    },
    {
      productName: "City",
      creator: "Phurichaya",
      category: "Production",
      price: "49",
      image: "../assets/images/products/production/City.jpg",
      link : "index.html",
    },
    {
      productName: "Leaf",
      creator: "Phruek and Chanon",
      category: "Production",
      price: "49",
      image: "../assets/images/products/production/Leaf_jumpchanon.jpg",
      link : "index.html",
    },
    {
      productName: "Goose",
      creator: "Phurichaya",
      category: "Production",
      price: "49",
      image: "../assets/images/products/production/Duck_hut.HEIC",
      link : "index.html",
    },
    {
      productName: "BTS",
      creator: "Chanon",
      category: "Production",
      price: "49",
      image: "../assets/images/products/production/BTS_chanon.jpg",
      link : "index.html",
    },
    {
      productName: "Barn",
      creator: "Thanut",
      category: "Production",
      price: "49",
      image: "../assets/images/products/production/Barn_TK.jpg",
      link : "index.html",
    },
    {
      productName: "Military",
      creator: "Phruek",
      category: "Production",
      price: "49",
      image: "../assets/images/products/production/Military.jpg",
      link : "index.html",
    },
    {
      productName: "Building",
      creator: "Kadsan",
      category: "Production",
      price: "49",
      image: "../assets/images/products/production/Building_Gram.Heic",
      link : "index.html",
    },
    {
      productName: "Cave",
      creator: "Phurichaya",
      category: "Production",
      price: "49",
      image: "../assets/images/products/production/Cave_hut.jpg",
      link : "index.html",
    },
    {
      productName: "Hua-Lum-Phong",
      creator: "Kadsan",
      category: "Production",
      price: "49",
      image: "../assets/images/products/production/HuaLumPhong_Gram.Heic",
      link : "index.html",
    },
    {
      productName: "Meow",
      creator: "Phurichaya",
      category: "Production",
      price: "49",
      image: "../assets/images/products/production/Meow_hut.jpg",
      link : "index.html",
    },
    
    {
      productName: "",
      creator: "Natapat",
      category: "GraphicDesign",
      price: "49",
      image: "../assets/images/products/graphic/Photomanipulate_TK.png",
      link : "index.html",
    },
    {
      productName: "Fujii",
      creator: "Phruek",
      category: "GraphicDesign",
      price: "49",
      image: "../assets/images/products/graphic/Fujii_jump.png",
      link : "index.html",
    },
     {
      productName: "Wallpaper",
      creator: "Natapat",
      category: "GraphicDesign",
      price: "49",
      image: "../assets/images/products/graphic/Wallpaper_Nat2.png",
      link : "index.html",
    },
    {
      productName: "Poster-Korat",
      creator: "Phruek",
      category: "GraphicDesign",
      price: "49",
      image: "../assets/images/products/graphic/Korat4_jump.jpg",
      link : "index.html",
    },
    {
      productName: "Poster-Kanom",
      creator: "Natapat",
      category: "GraphicDesign",
      price: "49",
      image: "../assets/images/products/graphic/Commerc_Nat.png",
      link : "index.html",
    },
    {
      productName: "Shirt",
      creator: "Natapat",
      category: "GraphicDesign",
      price: "49",
      image: "../assets/images/products/graphic/Natshirt.png",
      link : "index.html",
    },
    {
      productName: "Poster-Eminem",
      creator: "Phruek",
      category: "GraphicDesign",
      price: "49",
      image: "../assets/images/products/graphic/Eminem_jump.png",
      link : "index.html",
    },
     {
      productName: "Mahito",
      creator: "Phreuk",
      category: "Artwork",
      price: "49",
      image: "../assets/images/products/artwork/Mahito_jump.png",
      link : "index.html",
    },
    {
      productName: "Pixel-Pigachu",
      creator: "Phruek",
      category: "Artwork",
      price: "49",
      image: "../assets/images/products/artwork/Pixel_jump.png",
      link : "index.html",
    },
    {
      productName: "Pixel-TK",
      creator: "Thanut",
      category: "Artwork",
      price: "49",
      image: "../assets/images/products/artwork/TK-Pixel.png",
      link : "index.html",
    },
    {
      productName: "Pixel-Shrek",
      creator: "Phurikchaya",
      category: "Artwork",
      price: "49",
      image: "../assets/images/products/artwork/sherkhut.png",
      link : "index.html",
    },
    
  ],
};

for (let i of products.data) {
  //Create link wrapper
  let link = document.createElement("a");
  link.href = i.link || `product-detail.html?id=${i.productName.toLowerCase().replace(/\s+/g, '-')}`;
  link.classList.add("card-link");
  
  //Create Card
  let card = document.createElement("div");
  //Card should have category and should stay hidden initially
  card.classList.add("card", i.category);
  //image div
  let imgContainer = document.createElement("div");
  imgContainer.classList.add("image-container");
  //img tag
  let image = document.createElement("img");
  image.setAttribute("src", i.image);
  imgContainer.appendChild(image);
  card.appendChild(imgContainer);
  //container
  let container = document.createElement("div");
  container.classList.add("container");
  //creator name
  let creator = document.createElement("p");
  creator.classList.add("creator-name");
  creator.innerText = i.creator || "Unknown Creator";
  container.appendChild(creator);
  //product name
  let name = document.createElement("h5");
  name.classList.add("product-name");
  name.innerText = i.productName.toUpperCase();
  container.appendChild(name);
  //price
  let price = document.createElement("h6");
  price.innerText = "$" + i.price;
  container.appendChild(price);

  card.appendChild(container);
  link.appendChild(card);
  document.getElementById("products").appendChild(link);
}

// Initialize GSAP ScrollTrigger animations after cards are created
function initCardAnimations(isFiltering = false) {
  gsap.registerPlugin(ScrollTrigger);
  
  // Kill all existing ScrollTriggers to reset animations
  ScrollTrigger.getAll().forEach(trigger => trigger.kill());
  
  const cards = document.querySelectorAll('.card-link:not(.hide)');
  
  cards.forEach((card, index) => {
    // Reset card state for animation
    gsap.set(card, { opacity: 0, y: 50 });
    
    // For filtering, check if card is already in viewport
    const rect = card.getBoundingClientRect();
    const isInViewport = rect.top < window.innerHeight * 0.85;
    
    if (isFiltering && isInViewport) {
      // Immediate staggered animation for cards already in viewport
      gsap.to(card, {
        opacity: 1,
        y: 0,
        duration: 0.5,
        delay: index * 0.08,
        ease: "power2.out"
      });
    } else {
      // Scroll-triggered animation for cards below viewport
      gsap.to(card, {
        opacity: 1,
        y: 0,
        duration: 0.6,
        delay: index * 0.1,
        ease: "power2.out",
        scrollTrigger: {
          trigger: card,
          start: "top 85%",
          toggleActions: "play none none none"
        }
      });
    }
  });
}

//parameter passed from button (Parameter same as category)
function filterProduct(value) {
  // Clear search input when a category is clicked
  document.getElementById("search-input").value = "";

  //Button class code
  let buttons = document.querySelectorAll(".button-value");
  buttons.forEach((button) => {
    //check if value equals innerText
    if (value.toUpperCase() == button.innerText.toUpperCase()) {
      button.classList.add("active");
      // Update dropdown text
      updateCurrentFilter(button.innerText);
    } else {
      button.classList.remove("active");
    }
  });

  //select all cards and their parent links
  let elements = document.querySelectorAll(".card");
  let links = document.querySelectorAll(".card-link");
  //loop through all cards
  elements.forEach((element, index) => {
    const link = links[index];
    //display all cards on 'all' button click
    if (value == "all") {
      link.classList.remove("hide");
    } else {
      //Check if element contains category class
      if (element.classList.contains(value)) {
        //display element based on category
        link.classList.remove("hide");
      } else {
        //hide other elements
        link.classList.add("hide");
      }
    }
  });
  
  // Close dropdown on mobile after selection
  if (window.innerWidth <= 944 && isDropdownOpen) {
    closeDropdown();
  }
  
  // Re-initialize animations for filtered cards
  setTimeout(() => {
    initCardAnimations(true);
  }, 50);
}

//Search function
function searchProducts() {
  //initializations
  let searchInput = document.getElementById("search-input").value.trim().toUpperCase();
  let elements = document.querySelectorAll(".product-name");
  let cards = document.querySelectorAll(".card");
  let links = document.querySelectorAll(".card-link");

  //loop through all elements
  elements.forEach((element, index) => {
    //check if text includes the search value (case-insensitive)
    const link = links[index];
    const isSearchMatch = element.innerText.toUpperCase().includes(searchInput);

    if (isSearchMatch) {
      //display matching card
      link.classList.remove("hide");
    } else {
      //hide others
      link.classList.add("hide");
    }
  });
  
  // Re-initialize animations for search results
  setTimeout(() => {
    initCardAnimations(true);
  }, 50);
}

// Reset category to "All" when user starts searching
document.getElementById("search-input").addEventListener("input", () => {
  // When user types in search, deactivate category buttons
  let buttons = document.querySelectorAll(".button-value");
  buttons.forEach((button) => {
    if (!button.innerText.includes("All")) {
      button.classList.remove("active");
    } else {
      button.classList.add("active");
    }
  });
  searchProducts();
});


//Search button click
document.querySelector("button#search").addEventListener("click", searchProducts);

// Dropdown Filter Animation (Awwwards Style)
let isDropdownOpen = false;
const filterToggle = document.getElementById('filterToggle');
const filterButtons = document.getElementById('buttons');
const currentFilterText = document.querySelector('.current-filter');

function initDropdownAnimation() {
  if (!filterToggle) return;

  // Close dropdown when clicking outside
  document.addEventListener('click', (e) => {
    if (!e.target.closest('.filter-wrapper') && isDropdownOpen) {
      closeDropdown();
    }
  });

  filterToggle.addEventListener('click', (e) => {
    e.stopPropagation();
    if (isDropdownOpen) {
      closeDropdown();
    } else {
      openDropdown();
    }
  });

  // Handle window resize to fix visibility bug
  let resizeTimer;
  window.addEventListener('resize', () => {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(() => {
      handleResize();
    }, 150);
  });
}

function handleResize() {
  const isMobile = window.innerWidth <= 944;
  
  if (!isMobile) {
    // Desktop view - ensure filters are visible and reset dropdown state
    if (isDropdownOpen) {
      isDropdownOpen = false;
      filterToggle.classList.remove('active');
    }
    filterButtons.classList.remove('dropdown-open');
    // Reset GSAP properties for desktop
    gsap.set(filterButtons, { clearProps: "all" });
    const buttons = filterButtons.querySelectorAll('.button-value');
    gsap.set(buttons, { clearProps: "all" });
  } else {
    // Mobile view - ensure dropdown is properly closed
    if (isDropdownOpen) {
      closeDropdown();
    }
  }
}

function openDropdown() {
  isDropdownOpen = true;
  filterToggle.classList.add('active');
  filterButtons.classList.add('dropdown-open');

  // GSAP Animation - Awwwards style
  gsap.fromTo(filterButtons,
    {
      opacity: 0,
      scaleY: 0.8,
      y: -20
    },
    {
      opacity: 1,
      scaleY: 1,
      y: 0,
      duration: 0.4,
      ease: "power3.out"
    }
  );

  // Stagger animation for each button
  const buttons = filterButtons.querySelectorAll('.button-value');
  gsap.fromTo(buttons,
    {
      opacity: 0,
      x: -20
    },
    {
      opacity: 1,
      x: 0,
      duration: 0.3,
      stagger: 0.05,
      ease: "power2.out",
      delay: 0.1
    }
  );
}

function closeDropdown() {
  isDropdownOpen = false;
  filterToggle.classList.remove('active');

  // GSAP Animation - Smooth close
  gsap.to(filterButtons, {
    opacity: 0,
    scaleY: 0.9,
    y: -10,
    duration: 0.25,
    ease: "power2.in",
    onComplete: () => {
      filterButtons.classList.remove('dropdown-open');
    }
  });
}

// Update the current filter text in dropdown toggle
function updateCurrentFilter(filterName) {
  if (currentFilterText) {
    currentFilterText.textContent = filterName;
  }
}

//Initially display all products
window.onload = () => {
  filterProduct("all");
  // Initialize GSAP animations after products are loaded
  setTimeout(() => {
    initCardAnimations(false);
    initDropdownAnimation();
  }, 100);
};